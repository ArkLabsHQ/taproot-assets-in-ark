package main

import (
	"encoding/hex"
	"taponark"
)

func main() {

	const (
		//alice
		boardingUserDataDir     = "data"
		boardingUserTapTLSCert  = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949434f7a434341654b674177494241674951516e31374a59416934573378486c426c79716f526244414b42676771686b6a4f50515144416a41324d5341770a486759445651514b457864305958426b494746316447396e5a57356c636d46305a57516759325679644445534d4241474131554541784d4a59577870593255740a644746774d423458445449314d444d784d5445774e544d7a4d566f58445449324d4455774e6a45774e544d7a4d566f774e6a45674d4234474131554543684d580a644746775a434268645852765a3256755a584a686447566b49474e6c636e5178456a415142674e5642414d544357467361574e6c4c5852686344425a4d424d470a42797147534d34394167454743437147534d34394177454841304941424a7a7a454d4b46615752444364687730465243384a2b77476b4368745a5475487449620a7467663036324536442f6e54686a5239663271656976754f6a4e686e415a51665339644b684d684f555949425678426e4e61716a6764457767633477446759440a565230504151482f4241514441674b6b4d424d47413155644a51514d4d416f47434373474151554642774d424d41384741315564457745422f7751464d414d420a41663877485159445652304f42425945464f4a7677622b682f64664a4b2f73776c6752757a6b4c427a5149434d48634741315564455152774d473643435746730a61574e6c4c5852686349494a6247396a5957786f62334e3067676c6862476c6a5a53313059584343456e4276624746794c5734314c57467361574e6c4c5852680a63494945645735706549494b64573570654842685932746c64494948596e566d59323975626f63456677414141596351414141414141414141414141414141410a414141414159634572426f41427a414b42676771686b6a4f5051514441674e484144424541694251692f4674785564557a684f676d4642476f564c57747853590a736964714e4b4474324b694b5a6b756335774967664e5a4f366e5a4e6e385571514a776545506674376d567a52444b476c7858476f38446f57743449514a6b3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		boardingUserTapMacaroon = "0201047461706402d001030a10b9cef2f48e05ad7724eac24a6b65537c1201301a180a09616464726573736573120472656164120577726974651a150a06617373657473120472656164120577726974651a170a086368616e6e656c73120472656164120577726974651a150a066461656d6f6e120472656164120577726974651a130a046d696e74120472656164120577726974651a150a0670726f6f6673120472656164120577726974651a120a03726671120472656164120577726974651a170a08756e69766572736512047265616412057772697465000006200a64bd11a299a0eb2d68b690efca9e0c268b6f67b9bd40dbb23426b125b37d16"
		boardingUserRPCPort     = "12029"
		boardingUserRPCHostPort = "localhost:" + boardingUserRPCPort
		//bob
		exitUserDataDir     = "data"
		exitUserTapTLSCert  = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949434d7a434341646d674177494241674952414e693671755448756f464c47507a4c68416f3839754577436759494b6f5a497a6a3045417749774e4445670a4d4234474131554543684d58644746775a434268645852765a3256755a584a686447566b49474e6c636e51784544414f42674e5642414d5442324a76596931300a595841774868634e4d6a55774d7a45784d5441314d7a4d775768634e4d6a59774e5441324d5441314d7a4d77576a41304d534177486759445651514b457864300a5958426b494746316447396e5a57356c636d46305a57516759325679644445514d4134474131554541784d48596d39694c5852686344425a4d424d47427971470a534d34394167454743437147534d343941774548413049414245384346524a6b6e4252487250597253386352634577734e482f74666379763043623077764d640a5370444b485441324338364a5961394d7668746a76584a6d64566555666438644e446351526b56322b365a4d3656326a676373776763677744675944565230500a4151482f4241514441674b6b4d424d47413155644a51514d4d416f47434373474151554642774d424d41384741315564457745422f7751464d414d42416638770a485159445652304f42425945464b304935386b38774b704d5753744c4d4a6c56454c685a523961484d48454741315564455152714d47694342324a76596931300a5958434343577876593246736147397a64494948596d39694c585268634949516347397359584974626a5574596d39694c58526863494945645735706549494b0a64573570654842685932746c64494948596e566d59323975626f6345667741414159635141414141414141414141414141414141414141414159634572426f410a416a414b42676771686b6a4f5051514441674e4941444246416945413475344d45736343336c2b45572f6630552b6f4f486d7a71322f6430346f31706a2b68420a493162757644774349476b4b712f694e48444e5854515a4a77465071676a7967626c6971524f76592b38305832612b343456536b0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		exitUserTapMacaroon = "0201047461706402d001030a10d2703de762adc86831a7ce300edea5901201301a180a09616464726573736573120472656164120577726974651a150a06617373657473120472656164120577726974651a170a086368616e6e656c73120472656164120577726974651a150a066461656d6f6e120472656164120577726974651a130a046d696e74120472656164120577726974651a150a0670726f6f6673120472656164120577726974651a120a03726671120472656164120577726974651a170a08756e69766572736512047265616412057772697465000006208f063c6384375b5a2af35e5ac6a9f35f4681e765b331a9197e3ef1bc209679fd"
		exitUserRPCPort     = "12030"
		exitUserRPCHostPort = "localhost:" + exitUserRPCPort
		//server
		serverDataDir     = "data"
		serverTapTLSCert  = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949435054434341654f674177494241674952414d63566c6e3378744971336f48514a6f776758534d4577436759494b6f5a497a6a3045417749774e6a45670a4d4234474131554543684d58644746775a434268645852765a3256755a584a686447566b49474e6c636e5178456a415142674e5642414d5443574e68636d39730a4c58526863444165467730794e54417a4d5445784d44557a4d7a4261467730794e6a41314d4459784d44557a4d7a42614d4459784944416542674e5642416f540a4633526863475167595856306232646c626d56795958526c5a43426a5a584a304d524977454159445651514445776c6a59584a766243313059584177575441540a42676371686b6a4f5051494242676771686b6a4f50514d4242774e434141544d4f703357796838432b782f2f62794241764a3766394233755a343834572f46580a653149435746344d6e5a37714362664a61394b334c6f4b376b495150593241643068736e79566d78646e797775707562625153536f3448524d49484f4d4134470a41315564447745422f775145417749437044415442674e56485355454444414b4267677242674546425163444154415042674e5648524d4241663845425441440a4151482f4d42304741315564446751574242543730566936516e4533594d6f5944705148424661787347424e7054423342674e56485245456344427567676c6a0a59584a76624331305958434343577876593246736147397a6449494a59324679623277746447467767684a7762327868636931754e53316a59584a76624331300a595843434248567561586943436e56756158687759574e725a58534342324a315a6d4e76626d36484248384141414748454141414141414141414141414141410a4141414141414748424b776141415177436759494b6f5a497a6a304541774944534141775251496755495973724735386a586931654264554c322f47397032450a47553947747042732f527a446251356446465543495144412b6a67614349505a724f445069546e6d44536136325771664d46414d716f6d5835467a367154754d0a52673d3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		serverTapMacaroon = "0201047461706402d001030a105200c37faf689259d5004e8dae1c12601201301a180a09616464726573736573120472656164120577726974651a150a06617373657473120472656164120577726974651a170a086368616e6e656c73120472656164120577726974651a150a066461656d6f6e120472656164120577726974651a130a046d696e74120472656164120577726974651a150a0670726f6f6673120472656164120577726974651a120a03726671120472656164120577726974651a170a08756e69766572736512047265616412057772697465000006207e6d3db69a16fa7e1e9840cbf49460c78a6dbbdf2cca0a156072e2a83e4c8098"
		serverRPCPort     = "12031"
		serverRPCHostPort = "localhost:" + serverRPCPort
	)

	const (
		boardingUserLndTLSCert     = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d494943506a4343416553674177494241674952414d796f68566541634d57586a694575557668586e307777436759494b6f5a497a6a3045417749774d5445660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454f4d4177474131554541784d4659577870593255770a4868634e4d6a55774d7a45784d5441314d7a4d785768634e4d6a59774e5441324d5441314d7a4d78576a41784d523877485159445651514b45785a73626d51670a595856306232646c626d56795958526c5a43426a5a584a304d51347744415944565151444577566862476c6a5a54425a4d424d4742797147534d3439416745470a43437147534d343941774548413049414243676f6e2f514c73595250464156565079534c67705a32544c31484c7377716b376974434258772f4e4b644e782b440a7466417950376a447a462b65616f6732305a426968323932363167554978524f7a766e794a34326a6764777767646b7744675944565230504151482f424151440a41674b6b4d424d47413155644a51514d4d416f47434373474151554642774d424d41384741315564457745422f7751464d414d4241663877485159445652304f0a424259454646644c307a68507765334e754b5a516b41557a396e784d4c6945434d49474242674e5648524545656a42346767566862476c6a5a59494a6247396a0a5957786f62334e306767566862476c6a5a59494f6347397359584974626a5574595778705932574346476876633351755a47396a613256794c6d6c75644756790a626d467367675231626d6c3467677031626d6c346347466a613256306767646964575a6a623235756877522f41414142687841414141414141414141414141410a414141414141414268775373476741474d416f4743437147534d343942414d43413067414d45554349514462693843424d2b5274784c54726d4b2b43784862470a58374341467562427972583178524b5150306d41306749674b6d65747a572b735374752b5a72527a4e38686d414e6e4559482b4557675970776453724f5946480a662f343d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		boardingUserLndMacaroon    = "0201036c6e6402f801030a1071d32f6e3c0485671e1797daf5171f741201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e657261746512047265616400000620f41213cd5d32ea0b5458c5689a5f5f2bf780353aa6d20eb849637ce4f0ba5e53"
		boardingUserLndRpcPort     = "10001"
		boardingUserLndRpcHostPort = "localhost:" + boardingUserLndRpcPort

		exitUserLndTLSCert     = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d4949434d7a434341646d674177494241674952414f74586d36355a666d6f326774644d3142434e48564577436759494b6f5a497a6a3045417749774c7a45660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454d4d416f474131554541784d44596d39694d4234580a445449314d444d784d5445774e544d7a4d466f58445449324d4455774e6a45774e544d7a4d466f774c7a45664d4230474131554543684d576247356b494746310a6447396e5a57356c636d46305a575167593256796444454d4d416f474131554541784d44596d39694d466b77457759484b6f5a497a6a3043415159494b6f5a490a7a6a304441516344516741454e454d45647a777662376b4b5762532b584157664979362b496472307133524b4d4e674b6d496572534e713078514f74376744310a493542614448417164764764452b4b41304a777836773430593676376c5a4f6a4a4b4f4231544342306a414f42674e56485138424166384542414d43417151770a457759445652306c42417777436759494b775942425155484177457744775944565230544151482f42415577417745422f7a416442674e5648513445466751550a324d592b7347446761764a50656d6d362f42583053337536716a4977657759445652305242485177636f4944596d396967676c7362324e6862476876633353430a41324a76596f494d6347397359584974626a5574596d39696768526f62334e304c6d52765932746c63693570626e526c636d356862494945645735706549494b0a64573570654842685932746c64494948596e566d59323975626f6345667741414159635141414141414141414141414141414141414141414159634572426f410a417a414b42676771686b6a4f5051514441674e49414442464169454171686339627658556e34617274394e592b6830726c524e66346a5a6e746f3436522f4b710a433876486f6245434946637a4530674330316d542f53504e4541575251314e5535324f49474a73464c4a785968303230436a594f0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		exitUserLndMacaroon    = "0201036c6e6402f801030a10d17b0fc8348e9d4a7fe2b9f767b6cc3f1201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e657261746512047265616400000620c8889bcc7525dca28cb81b809e6742901189f18d5923e81eb83814bce6c2d60b"
		exitUserLndRpcPort     = "10002"
		exitUserLndRpcHostPort = "localhost:" + exitUserLndRpcPort

		serverLndTLSCert     = "2d2d2d2d2d424547494e2043455254494649434154452d2d2d2d2d0a4d49494350544343416553674177494241674952414e5555614f68377831324543706e6e5334616655536b77436759494b6f5a497a6a3045417749774d5445660a4d4230474131554543684d576247356b494746316447396e5a57356c636d46305a575167593256796444454f4d4177474131554541784d4659324679623277770a4868634e4d6a55774d7a45784d5441314d7a4d775768634e4d6a59774e5441324d5441314d7a4d77576a41784d523877485159445651514b45785a73626d51670a595856306232646c626d56795958526c5a43426a5a584a304d51347744415944565151444577566a59584a766244425a4d424d4742797147534d3439416745470a43437147534d343941774548413049414242373673345a55465750656f6a554a49544c336f736a5272696e5434633430474e3431754d62795351704c413734610a425a72486e504f465476464b4656677833756565314f6c5a7763734f30693262385550693345656a6764777767646b7744675944565230504151482f424151440a41674b6b4d424d47413155644a51514d4d416f47434373474151554642774d424d41384741315564457745422f7751464d414d4241663877485159445652304f0a4242594546494c673667554f764745564831316b736f436165644e5143724e6a4d49474242674e5648524545656a42346767566a59584a766249494a6247396a0a5957786f62334e306767566a59584a766249494f6347397359584974626a5574593246796232794346476876633351755a47396a613256794c6d6c75644756790a626d467367675231626d6c3467677031626d6c346347466a613256306767646964575a6a623235756877522f41414142687841414141414141414141414141410a414141414141414268775373476741494d416f4743437147534d343942414d43413063414d45514349437430485343484e4d6262443131787a63515357486f520a69794b496f794934746479587466306c59766d494169414741504d645167464f3430376e354d2f5a433059785165654d624d79392f4c4274514b677069364c650a31673d3d0a2d2d2d2d2d454e442043455254494649434154452d2d2d2d2d0a"
		serverLndMacaroon    = "0201036c6e6402f801030a1019b1115fedca21b2edbd5ace33c60cf11201301a160a0761646472657373120472656164120577726974651a130a04696e666f120472656164120577726974651a170a08696e766f69636573120472656164120577726974651a210a086d616361726f6f6e120867656e6572617465120472656164120577726974651a160a076d657373616765120472656164120577726974651a170a086f6666636861696e120472656164120577726974651a160a076f6e636861696e120472656164120577726974651a140a057065657273120472656164120577726974651a180a067369676e6572120867656e657261746512047265616400000620a415d6dd773a5bf6e22fa2d37a2018ac1d809fd13c9b02d983e9e807243490e4"
		serverLndRpcPort     = "10003"
		serverLndRPCHostPort = "localhost:" + serverLndRpcPort
	)

	assetId, _ := hex.DecodeString("c5af809cf2c04830d55af5bf1f6d34fe79246c199709ca16fd8199e8fe017ecd")
	boardingAssetAmnt := 40
	boardingBtcAmnt := 100_000

	boardingUserLndClient := taponark.InitLndClient(boardingUserLndRpcHostPort, boardingUserLndRpcPort, boardingUserLndTLSCert, boardingUserLndMacaroon)
	boardingUserTapClient := taponark.InitTapClient(boardingUserRPCHostPort, boardingUserRPCPort, boardingUserTapTLSCert, boardingUserTapMacaroon, boardingUserLndClient)

	exitUserLndClient := taponark.InitLndClient(exitUserLndRpcHostPort, exitUserLndRpcPort, exitUserLndTLSCert, exitUserLndMacaroon)
	exitUserTapClient := taponark.InitTapClient(exitUserRPCHostPort, exitUserRPCPort, exitUserTapTLSCert, exitUserTapMacaroon, exitUserLndClient)

	serverLndClient := taponark.InitLndClient(serverLndRPCHostPort, serverLndRpcPort, serverLndTLSCert, serverLndMacaroon)
	serverTapClient := taponark.InitTapClient(serverRPCHostPort, serverRPCPort, serverTapTLSCert, serverTapMacaroon, serverLndClient)

	boardingTransfer := taponark.SpendToBoardingTransaction(assetId, uint64(boardingAssetAmnt), uint64(boardingBtcAmnt), &boardingUserTapClient, &serverTapClient)

	roundRootSpendingDetails := taponark.CreateRoundSpendingDetails(&exitUserTapClient, &serverTapClient)
	roundRootTransfer := taponark.SpendFromBoardingTransfer(assetId, boardingTransfer, roundRootSpendingDetails, &serverTapClient)

	fullproof := serverTapClient.ExportProof(assetId,
		boardingTransfer.AssetTransferDetails.AssetTransferOutput.ScriptKey,
	)

	proofList, proofFile := taponark.CreateRoundTransfer(fullproof.RawProofFile, roundRootSpendingDetails, roundRootTransfer, assetId, &exitUserTapClient, &serverTapClient, 2)
	taponark.PublishTransfersAndSubmitProofs(assetId, proofList, fullproof.GenesisPoint, proofFile, &exitUserTapClient)
	// wait for transfer to reach

}
